# Tasks: Core UI Primitives Transfer (009)

**Input**: Design documents from `/specs/009-core-primitives-transfer/`
**Prerequisites**: plan.md ‚úÖ, spec.md ‚úÖ, research.md ‚úÖ, data-model.md ‚úÖ, contracts/ ‚úÖ
**Workflow**: Part of mandatory SpecKit workflow (Constitutional Principle XV). Generated by `/speckit.tasks`.

**Tests**: Per Constitutional Principle XVI (TDD), tests are MANDATORY and MUST be written BEFORE implementation.

- Task format: `T###-test` (write failing test) ‚Üí `T###-impl` (make test pass)
- Coverage target: 80%+ for merge to main
- Design source: `assets/aistudio/v3/shared/ui/`

**Organization**: Tasks are grouped by user story (US1-US5) to enable independent implementation and testing.

## Format: `[ID] [P?] [Story?] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- **[Story]**: Which user story this task belongs to (US1-US5)
- Include exact file paths in descriptions

---

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: Verify environment and create test infrastructure

- [x] T001 Verify worktree and dependencies with `pnpm install && pnpm type-check` | Deviation: None
- [x] T002 [P] Create test directory structure at `src/shared/ui/__tests__/` | Deviation: None (already exists)
- [x] T003 [P] Verify Vitest config supports component testing with @testing-library/react | Deviation: None

**Checkpoint**: Test infrastructure ready

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: Shared utilities that ALL user stories depend on

**‚ö†Ô∏è CRITICAL**: No user story work can begin until this phase is complete

- [x] T004 [P] Create shared test utilities in `src/shared/ui/__tests__/test-utils.ts` (render helper, userEvent setup) | Deviation: None
- [x] T005 Verify cn() utility exists in `src/shared/lib/utils.ts` for className merging | Deviation: None (already exists)

**Checkpoint**: Foundation ready - user story implementation can begin

---

## Phase 3: User Story 1 - Text Input with Validation Feedback (Priority: P1) üéØ MVP

**Goal**: Input component with label, error state, icon support, and focus glow

**Independent Test**: Render Input with various states (default, error, with icon) and verify visual/accessibility behavior

### Tests for User Story 1 (TDD - write FIRST, ensure they FAIL) üî¥

- [x] T010-test [P] [US1] Unit test for Input rendering default state in `src/shared/ui/__tests__/input.test.tsx` | Deviation: None
- [x] T011-test [P] [US1] Unit test for Input with label and error state in `src/shared/ui/__tests__/input.test.tsx` | Deviation: None
- [x] T012-test [P] [US1] Unit test for Input with icon (leading/trailing) in `src/shared/ui/__tests__/input.test.tsx` | Deviation: None
- [x] T013-test [US1] Unit test for Input accessibility (aria-label, aria-invalid) in `src/shared/ui/__tests__/input.test.tsx` | Deviation: None

### Implementation for User Story 1 (TDD - make tests PASS) üü¢

- [x] T010-impl [US1] Implement Input base component with CVA variants in `src/shared/ui/input.tsx` | Deviation: None
- [x] T011-impl [US1] Add label and error state support to Input (make T011-test pass) | Deviation: None
- [x] T012-impl [US1] Add icon support with position prop (make T012-test pass) | Deviation: None
- [x] T013-impl [US1] Add accessibility attributes (make T013-test pass) | Deviation: None
- [x] T014 [US1] Export Input from `src/shared/ui/index.ts` | Deviation: None
- [x] T015 [US1] Run coverage check for Input (target: 80%+) | Deviation: None (100% coverage achieved)

**Checkpoint**: User Story 1 complete. Verify: `pnpm test src/shared/ui/__tests__/input.test.tsx --coverage`

---

## Phase 4: User Story 2 - Multi-line Text Entry for Notes (Priority: P2)

**Goal**: Textarea component with label, disabled resize, and focus glow

**Independent Test**: Render Textarea and verify styling, resize behavior, and focus states

### Tests for User Story 2 (TDD - write FIRST) üî¥

- [x] T020-test [P] [US2] Unit test for Textarea rendering default state in `src/shared/ui/__tests__/textarea.test.tsx` | Deviation: None
- [x] T021-test [P] [US2] Unit test for Textarea with label in `src/shared/ui/__tests__/textarea.test.tsx` | Deviation: None
- [x] T022-test [US2] Unit test for Textarea resize disabled (CSS class check) in `src/shared/ui/__tests__/textarea.test.tsx` | Deviation: None

### Implementation for User Story 2 (TDD - make tests PASS) üü¢

- [x] T020-impl [US2] Implement Textarea base component with CVA in `src/shared/ui/textarea.tsx` | Deviation: Used inline classes instead of CVA (simpler, same result)
- [x] T021-impl [US2] Add label support to Textarea (make T021-test pass) | Deviation: None
- [x] T022-impl [US2] Ensure resize-none class applied (make T022-test pass) | Deviation: None
- [x] T023 [US2] Export Textarea from `src/shared/ui/index.ts` | Deviation: None
- [x] T024 [US2] Run coverage check for Textarea (target: 80%+) | Deviation: None

**Checkpoint**: User Story 2 complete. Verify: `pnpm test src/shared/ui/__tests__/textarea.test.tsx --coverage`

---

## Phase 5: User Story 3 - Status Badges for Invoice States (Priority: P2)

**Goal**: Badge component with four variants (default, success, warning, outline)

**Independent Test**: Render each badge variant and verify correct visual appearance

### Tests for User Story 3 (TDD - write FIRST) üî¥

- [x] T030-test [P] [US3] Unit test for Badge default variant in `src/shared/ui/__tests__/badge.test.tsx` | Deviation: None
- [x] T031-test [P] [US3] Unit test for Badge success variant in `src/shared/ui/__tests__/badge.test.tsx` | Deviation: None
- [x] T032-test [P] [US3] Unit test for Badge warning variant in `src/shared/ui/__tests__/badge.test.tsx` | Deviation: None
- [x] T033-test [P] [US3] Unit test for Badge outline variant in `src/shared/ui/__tests__/badge.test.tsx` | Deviation: None

### Implementation for User Story 3 (TDD - make tests PASS) üü¢

- [x] T030-impl [US3] Implement Badge component with all CVA variants in `src/shared/ui/badge.tsx` | Deviation: None
- [x] T031-impl [US3] Export badgeVariants for external use in `src/shared/ui/badge.tsx` | Deviation: None
- [x] T032 [US3] Export Badge from `src/shared/ui/index.ts` | Deviation: None
- [x] T033 [US3] Run coverage check for Badge (target: 80%+) | Deviation: None

**Checkpoint**: User Story 3 complete. Verify: `pnpm test src/shared/ui/__tests__/badge.test.tsx --coverage`

---

## Phase 6: User Story 4 - Consistent Typography Hierarchy (Priority: P2)

**Goal**: Heading (hero-h4) and Text (body-tiny) components with polymorphic `as` prop

**Independent Test**: Render each typography variant and verify correct sizing/styling

### Tests for User Story 4 (TDD - write FIRST) üî¥

- [x] T040-test [P] [US4] Unit test for Heading variants (hero, h1-h4) in `src/shared/ui/__tests__/typography.test.tsx` | Deviation: None
- [x] T041-test [P] [US4] Unit test for Heading polymorphic `as` prop in `src/shared/ui/__tests__/typography.test.tsx` | Deviation: None
- [x] T042-test [P] [US4] Unit test for Text variants (body, large, small, tiny, muted, label) in `src/shared/ui/__tests__/typography.test.tsx` | Deviation: None
- [x] T043-test [P] [US4] Unit test for Text polymorphic `as` prop in `src/shared/ui/__tests__/typography.test.tsx` | Deviation: None
- [x] T044-test [US4] Unit test for Text mono prop (Geist Mono font) in `src/shared/ui/__tests__/typography.test.tsx` | Deviation: None

### Implementation for User Story 4 (TDD - make tests PASS) üü¢

- [x] T040-impl [US4] Implement Heading component with CVA variants in `src/shared/ui/typography.tsx` | Deviation: None
- [x] T041-impl [US4] Add polymorphic `as` prop to Heading with default element mapping | Deviation: None
- [x] T042-impl [US4] Implement Text component with CVA variants in `src/shared/ui/typography.tsx` | Deviation: None
- [x] T043-impl [US4] Add polymorphic `as` prop to Text with default element mapping | Deviation: None
- [x] T044-impl [US4] Add mono prop support for monospace font | Deviation: None
- [x] T045 [US4] Export Heading, Text, and variants from `src/shared/ui/index.ts` | Deviation: None
- [x] T046 [US4] Run coverage check for Typography (target: 80%+) | Deviation: None

**Checkpoint**: User Story 4 complete. Verify: `pnpm test src/shared/ui/__tests__/typography.test.tsx --coverage`

---

## Phase 7: User Story 5 - Glass Effect Card Variant (Priority: P3)

**Goal**: Add glass variant to existing Card component (backward compatible)

**Independent Test**: Render Card with glass variant and verify visual effect; verify default variant unchanged

### Tests for User Story 5 (TDD - write FIRST) üî¥

- [x] T050-test [P] [US5] Unit test for Card default variant (backward compatibility) in `src/shared/ui/__tests__/card.test.tsx` | Deviation: None
- [x] T051-test [P] [US5] Unit test for Card glass variant in `src/shared/ui/__tests__/card.test.tsx` | Deviation: None
- [x] T052-test [US5] Unit test for Card sub-components (CardHeader, CardContent, CardFooter) in `src/shared/ui/__tests__/card.test.tsx` | Deviation: None

### Implementation for User Story 5 (TDD - make tests PASS) üü¢

- [x] T050-impl [US5] Analyze existing Card in `src/shared/ui/card.tsx` for modification points | Deviation: None
- [x] T051-impl [US5] Add CVA variants to Card (default, glass) preserving backward compatibility | Deviation: None
- [x] T052-impl [US5] Verify all sub-components work with both variants | Deviation: None
- [x] T053 [US5] Run coverage check for Card (target: 80%+) | Deviation: None

**Checkpoint**: User Story 5 complete. Verify: `pnpm test src/shared/ui/__tests__/card.test.tsx --coverage`

---

## Phase 8: Polish & Cross-Cutting Concerns

**Purpose**: Final validation and integration

- [x] T060 [P] Run full test suite with coverage: `pnpm test:coverage` | Deviation: None (326 tests pass, 95%+ coverage)
- [x] T061 [P] Run type check: `pnpm type-check` | Deviation: None
- [x] T062 [P] Run lint: `pnpm lint` | Deviation: None
- [x] T063 Verify all exports in `src/shared/ui/index.ts` are correct | Deviation: None
- [x] T064 Run quickstart.md validation checklist | Deviation: None (all components implemented per spec)

**Checkpoint**: All user stories complete. Final coverage: 80%+

---

## Phase FINAL: Memory Updates (MANDATORY - Constitutional Principle XIV)

**Purpose**: Update Serena memories to keep project knowledge current

**‚ö†Ô∏è CRITICAL**: This phase is NON-OPTIONAL. Feature completion without memory updates is a Constitutional violation.

- [x] TMEM-1 Update `development-status` memory with completed feature | Deviation: None
- [x] TMEM-2 Update `tech-stack-locked` if any dependencies changed | Deviation: Skipped (no new deps)
- [x] TMEM-3 Write new memory for CVA component pattern if reusable pattern discovered | Deviation: Pattern already established, no new memory needed
- [x] TMEM-4 Update ROADMAP_P0.md with P0.8.0 completion status | Deviation: Done via development-status memory

**Checkpoint**: All relevant memories updated. Feature ready for merge.

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: No dependencies - can start immediately
- **Foundational (Phase 2)**: Depends on Setup completion - BLOCKS all user stories
- **User Stories (Phases 3-7)**: All depend on Foundational phase completion
  - US1 (P1): MVP - complete first
  - US2, US3, US4 (P2): Can proceed in parallel after US1 or concurrently
  - US5 (P3): Enhancement - complete last
- **Polish (Phase 8)**: Depends on all user stories being complete
- **Memory (Phase FINAL)**: Depends on Polish phase completion

### User Story Dependencies

| Story            | Priority | Can Start After | Parallel With    |
| ---------------- | -------- | --------------- | ---------------- |
| US1 (Input)      | P1       | Phase 2         | None (MVP first) |
| US2 (Textarea)   | P2       | Phase 2         | US3, US4         |
| US3 (Badge)      | P2       | Phase 2         | US2, US4         |
| US4 (Typography) | P2       | Phase 2         | US2, US3         |
| US5 (Card)       | P3       | Phase 2         | US2, US3, US4    |

### Within Each User Story (TDD Cycle)

1. All `T###-test` tasks MUST be written first and FAIL (Red phase)
2. `T###-impl` tasks make tests pass (Green phase)
3. Refactor only when tests are green (Refactor phase)
4. Coverage check at checkpoint (must be ‚â•80%)

---

## Parallel Examples

### Phase 3 (User Story 1 - Input) - TDD Cycle

```bash
# RED PHASE: Write all Input tests in parallel (must fail)
Task: "T010-test: Unit test for Input default state"
Task: "T011-test: Unit test for Input label/error"
Task: "T012-test: Unit test for Input icon"
Task: "T013-test: Unit test for Input accessibility"

# GREEN PHASE: Implement sequentially (each makes its test pass)
Task: "T010-impl: Implement Input base (make T010-test pass)"
Task: "T011-impl: Add label/error (make T011-test pass)"
Task: "T012-impl: Add icon support (make T012-test pass)"
Task: "T013-impl: Add a11y attributes (make T013-test pass)"
```

### Parallel User Stories (After MVP)

```bash
# After US1 (MVP) complete, can run P2 stories in parallel:
Agent A: "Phase 4 (US2 - Textarea)"
Agent B: "Phase 5 (US3 - Badge)"
Agent C: "Phase 6 (US4 - Typography)"
```

---

## Implementation Strategy

### MVP First (User Story 1 Only)

1. Complete Phase 1: Setup
2. Complete Phase 2: Foundational
3. Complete Phase 3: User Story 1 (Input)
4. **STOP and VALIDATE**: Test Input independently
5. Deploy/demo if ready - MVP achieved!

### Incremental Delivery (Recommended)

1. Setup + Foundational ‚Üí Foundation ready
2. **US1 (Input)** ‚Üí Test ‚Üí **MVP!** ‚úÖ
3. US2 (Textarea) ‚Üí Test ‚Üí Increment
4. US3 (Badge) ‚Üí Test ‚Üí Increment
5. US4 (Typography) ‚Üí Test ‚Üí Increment
6. US5 (Card glass) ‚Üí Test ‚Üí Complete
7. Polish + Memory ‚Üí Ready for merge

---

## Summary

| Metric                     | Value                                    |
| -------------------------- | ---------------------------------------- |
| **Total Tasks**            | 56 (including tests)                     |
| **User Stories**           | 5                                        |
| **Tasks per Story**        | US1: 10, US2: 8, US3: 7, US4: 12, US5: 7 |
| **Setup/Foundational**     | 5                                        |
| **Polish**                 | 5                                        |
| **Memory**                 | 4                                        |
| **Parallel Opportunities** | 25 tasks marked [P]                      |
| **MVP Scope**              | Phase 1-3 (Setup + Foundational + US1)   |
| **Coverage Target**        | 80%+ per component                       |

---

## Notes

- All test tasks follow TDD: write test first, ensure it FAILS, then implement
- [P] tasks can run in parallel (different files)
- Coverage check at each user story checkpoint
- Commit after each task or logical group
- Stop at any checkpoint to validate story independently

### Deviation Tracking (Principle IX)

When marking tasks complete, record any implementation deviations:

**Format**: `- [x] T001 [Description] | Deviation: [None | <deviation description>]`

### ROADMAP Update (Principle IX)

Upon completion, update `ROADMAP_P0.md` with:

- Feature completion status
- Feature folder path: `specs/009-core-primitives-transfer/`
- Implementation summary
- Any deviations from plan
